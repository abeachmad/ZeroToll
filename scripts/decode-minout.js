/**
 * Decode transaction input data untuk compare minOut
 */

// TX GAGAL #1: 0x22bc8dff (Amoy USDC → WMATIC)
const failedInput1 = "0xe60269c600000000000000000000000000000000000000000000000000000000000000600000000000000000000000007cafe27c7367fa0e929d4e83578cec838e3ceec700000000000000000000000000000000000000000000000000000000000002000000000000000000000000005a87a3c738cf99db95787d51b627217b6de12f6200000000000000000000000041e94eb019c0762f9bfcf9fb1e58725bfb0e758200000000000000000000000000000000000000000000000000000000000f4240000000000000000000000000360ad4f9a9a8efe9a8dcb5f461c4cc1047e1dcf9000000000000000000000000000000000000000000000000004d1c6bba68300000000000000000000000000000000000000000000000000000000000001388200000000000000000000000000000000000000000000000000000000690f7deb00000000000000000000000041e94eb019c0762f9bfcf9fb1e58725bfb0e75820000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000690f7b93000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c49908fc8b00000000000000000000000041e94eb019c0762f9bfcf9fb1e58725bfb0e7582000000000000000000000000360ad4f9a9a8efe9a8dcb5f461c4cc1047e1dcf900000000000000000000000000000000000000000000000000000000000f4240000000000000000000000000000000000000000000000000004d1c6bba683000000000000000000000000005335f887e69f4b920bb037062382b9c17aa52ec600000000000000000000000000000000000000000000000000000000690f7deb00000000000000000000000000000000000000000000000000000000";

// TX BERHASIL #1: 0x65c40c20 (Amoy WMATIC → USDC)  
const successInput1 = "0xe60269c600000000000000000000000000000000000000000000000000000000000000600000000000000000000000007cafe27c7367fa0e929d4e83578cec838e3ceec700000000000000000000000000000000000000000000000000000000000002000000000000000000000000005a87a3c738cf99db95787d51b627217b6de12f62000000000000000000000000360ad4f9a9a8efe9a8dcb5f461c4cc1047e1dcf90000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000041e94eb019c0762f9bfcf9fb1e58725bfb0e7582000000000000000000000000000000000000000000000000000000000008554a000000000000000000000000000000000000000000000000000000000001388200000000000000000000000000000000000000000000000000000000690f7e6b000000000000000000000000360ad4f9a9a8efe9a8dcb5f461c4cc1047e1dcf90000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000690f7c13000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c49908fc8b000000000000000000000000360ad4f9a9a8efe9a8dcb5f461c4cc1047e1dcf900000000000000000000000041e94eb019c0762f9bfcf9fb1e58725bfb0e75820000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000000000000000000000000000000000000008554a0000000000000000000000005335f887e69f4b920bb037062382b9c17aa52ec600000000000000000000000000000000000000000000000000000000690f7e6b00000000000000000000000000000000000000000000000000000000";

console.log("=== DECODING TRANSACTION INPUT DATA ===\n");

// Parse minOut from calldata
// Position: bytes 4-35 = function selector
// Intent struct starts at offset 96 (0x60)
// minOut is 5th parameter in intent struct

function parseMinOut(hexData, decimals) {
  // executeIntent(RouteInstruction calldata route, address adapter, uint256 feeMode)
  // route struct:
  //   user (32 bytes at offset 96)
  //   tokenIn (32 bytes at offset 128)
  //   amtIn (32 bytes at offset 160)
  //   tokenOut (32 bytes at offset 192)
  //   minOut (32 bytes at offset 224) ← HERE
  
  const minOutStart = 2 + 8 + (32 * 2 * 4); // Skip 0x + selector + first 4 params
  const minOutHex = '0x' + hexData.slice(minOutStart, minOutStart + 64);
  const minOutBigInt = BigInt(minOutHex);
  const minOutDecimal = Number(minOutBigInt) / Math.pow(10, decimals);
  return { hex: minOutHex, decimal: minOutDecimal, raw: minOutBigInt.toString() };
}

console.log("FAILED TX #1 (Amoy USDC → WMATIC):");
const failed1MinOut = parseMinOut(failedInput1, 18); // WMATIC 18 decimals
console.log(`  minOut: ${failed1MinOut.decimal.toFixed(6)} WMATIC`);
console.log(`  Raw: ${failed1MinOut.raw}`);
console.log(`  Hex: ${failed1MinOut.hex}`);
console.log("");

console.log("SUCCESS TX #1 (Amoy WMATIC → USDC):");
const success1MinOut = parseMinOut(successInput1, 6); // USDC 6 decimals
console.log(`  minOut: ${success1MinOut.decimal.toFixed(6)} USDC`);
console.log(`  Raw: ${success1MinOut.raw}`);
console.log(`  Hex: ${success1MinOut.hex}`);
console.log("");

console.log("=== COMPARISON ===");
console.log("FAILED: Expected ~5.54 WMATIC, minOut =", failed1MinOut.decimal.toFixed(2), "WMATIC");
console.log("SUCCESS: Expected ~0.547 USDC, minOut =", success1MinOut.decimal.toFixed(3), "USDC");
console.log("");
console.log("If minOut on failed tx is MUCH HIGHER than expected → THAT'S THE BUG!");
